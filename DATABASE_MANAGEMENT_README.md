# 数据库管理功能说明

## 功能概述

FireflyCloud 现在提供了完整的数据库可视化管理功能，管理员可以通过友好的界面查看和管理数据库中的所有数据。

## 主要功能

### 1. 数据库概览
- **统计卡片**: 显示数据库表数量、总记录数、用户数量、文件数量
- **实时数据**: 所有统计数据都是实时从数据库获取
- **可视化图标**: 每种数据类型都有对应的图标标识

### 2. 数据表管理
- **表格列表**: 显示所有数据库表的详细信息
- **记录统计**: 每个表显示当前记录数量
- **表描述**: 清晰的表功能说明
- **图标标识**: 不同表类型有不同的图标

### 3. 数据查看功能
- **详细数据**: 点击"查看数据"可查看表中的所有记录
- **列信息**: 显示表的所有列名
- **数据格式化**: 
  - 时间戳自动转换为可读日期
  - 文件大小自动格式化（B, KB, MB, GB）
  - 布尔值显示为"是/否"
  - 长文本自动截断并显示省略号
- **工具提示**: 鼠标悬停可查看完整内容

### 4. 搜索功能
- **实时搜索**: 在数据表中实时搜索任意内容
- **全列搜索**: 搜索会匹配所有列的内容
- **搜索结果统计**: 显示找到的记录数量
- **搜索高亮**: 清晰显示搜索状态

### 5. 安全特性
- **敏感数据保护**: 自动隐藏密码、密钥等敏感信息
- **管理员权限**: 只有管理员可以访问数据库管理功能
- **只读访问**: 当前版本只提供查看功能，不支持修改

## 支持的数据表

### 1. 用户表 (users)
- **功能**: 存储用户账户信息
- **字段**: ID、邮箱、角色、邮箱验证状态、创建时间、更新时间
- **安全**: 密码字段自动隐藏

### 2. 文件表 (files)
- **功能**: 存储文件元数据信息
- **字段**: ID、用户ID、文件名、原始名称、大小、类型、存储方式、路径、创建时间
- **特色**: 文件大小自动格式化显示

### 3. 邮箱验证码表 (email_verification_codes)
- **功能**: 存储邮箱验证码记录
- **字段**: ID、邮箱、验证码、过期时间、使用状态、创建时间
- **用途**: 用于邮箱验证功能的管理

### 4. SMTP配置表 (smtp_config)
- **功能**: 存储邮件服务器配置
- **字段**: ID、启用状态、主机、端口、用户名、安全连接、更新时间
- **安全**: 密码字段自动隐藏

### 5. 存储配置表 (storage_config)
- **功能**: 存储文件存储配置
- **字段**: ID、存储类型、R2端点、访问密钥、存储桶、更新时间
- **安全**: 密钥字段自动隐藏

## 使用方法

### 1. 访问数据库管理
1. 使用管理员账户登录
2. 在左侧菜单栏的"系统管理"部分
3. 点击"数据库管理"选项

### 2. 查看数据库概览
- 页面顶部显示四个统计卡片
- 实时显示当前数据库状态
- 点击"刷新"按钮更新数据

### 3. 查看表数据
1. 在表格列表中找到要查看的表
2. 点击"查看数据"按钮
3. 在弹出的对话框中查看详细数据

### 4. 搜索数据
1. 在数据查看对话框中
2. 在搜索框中输入关键词
3. 系统会实时过滤显示匹配的记录

## API 接口

### 1. 获取数据库表列表
```
GET /admin/database/tables
```

### 2. 获取指定表数据
```
GET /admin/database/table/:tableName
```

## 页面结构

### 1. 独立页面设计
- **路由**: `/admin/database`
- **位置**: 左侧菜单栏 → 系统管理 → 数据库管理
- **布局**: 使用统一的 AppLayout 布局
- **导航**: 包含面包屑导航，便于用户定位

### 2. 页面组成
- **面包屑导航**: 系统管理 → 数据库管理
- **页面标题**: 带图标的标题和描述
- **刷新按钮**: 右上角的数据刷新功能
- **统计概览**: 四个统计卡片
- **表格列表**: 所有数据表的展示

## 技术特性

- **响应式设计**: 支持各种屏幕尺寸
- **实时数据**: 所有数据都是实时从数据库获取
- **性能优化**: 使用 React useMemo 优化搜索性能
- **用户体验**: 加载状态、错误处理、友好提示
- **安全设计**: 敏感数据自动隐藏，权限控制
- **一致性设计**: 与管理面板保持统一的设计风格

## 未来计划

- [ ] 数据导出功能
- [ ] 数据备份功能
- [ ] 数据统计图表
- [ ] 数据修改功能（谨慎考虑）
- [ ] 数据库性能监控
