<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R2æ ¹è·¯å¾„SSRä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        .fix-item {
            margin: 10px 0;
            padding: 10px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ R2æ ¹è·¯å¾„SSRä¿®å¤æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>é—®é¢˜æè¿°</h2>
        <div class="status error">
            <strong>åŸå§‹é”™è¯¯:</strong><br>
            âŒ åªæœ‰åœ¨R2è·¯å¾„é€‰æ‹©äº†æ ¹ç›®å½•çš„æƒ…å†µä¸‹ä¼šæŠ¥é”™<br>
            âŒ ç›´æ¥é€‰æ‹©å…·ä½“çš„æ–‡ä»¶å¤¹åˆ™ä¸ä¼šæŠ¥é”™<br>
            âŒ TypeError: Please use the 'new' operator, this DOM object constructor cannot be called as a function.<br>
            âŒ é—®é¢˜å‡ºç°åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æ—¶è®¿é—®æµè§ˆå™¨API
        </div>
    </div>

    <div class="test-section">
        <h2>é—®é¢˜åˆ†æ</h2>
        <div class="status info">
            <strong>æ ¹æœ¬åŸå› :</strong><br>
            1. R2æµè§ˆå™¨ç»„ä»¶åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æ—¶ä½¿ç”¨äº†URLSearchParams<br>
            2. formatDateå‡½æ•°ä½¿ç”¨äº†toLocaleString<br>
            3. å…¶ä»–ç»„ä»¶ä½¿ç”¨äº†navigator.clipboardç­‰æµè§ˆå™¨API<br>
            4. æ ¹è·¯å¾„é€‰æ‹©æ—¶è§¦å‘äº†ç‰¹å®šçš„æ¸²æŸ“é€»è¾‘
        </div>
    </div>

    <div class="test-section">
        <h2>ä¿®å¤å†…å®¹</h2>
        
        <div class="fix-item">
            <strong>1. ä¿®å¤URLSearchParamsä½¿ç”¨</strong><br>
            <div class="code-block">
// ä¿®æ”¹å‰
const params = new URLSearchParams()
if (path) {
  params.append("prefix", path)
}
const response = await fetch(`${API_URL}/storage/r2/browse?${params}`)

// ä¿®æ”¹å
let queryString = ""
if (typeof URLSearchParams !== 'undefined') {
  const params = new URLSearchParams()
  if (path) {
    params.append("prefix", path)
  }
  queryString = params.toString()
} else {
  queryString = path ? `prefix=${encodeURIComponent(path)}` : ""
}
const response = await fetch(`${API_URL}/storage/r2/browse${queryString ? `?${queryString}` : ""}`)
            </div>
            <p>åªåœ¨å®¢æˆ·ç«¯ä½¿ç”¨URLSearchParamsï¼ŒæœåŠ¡å™¨ç«¯ä½¿ç”¨å›é€€æ–¹æ¡ˆ</p>
        </div>

        <div class="fix-item">
            <strong>2. ä¿®å¤toLocaleStringä½¿ç”¨</strong><br>
            <div class="code-block">
// ä¿®æ”¹å‰
const formatDate = (dateString: string) => {
  return new Date(dateString).toLocaleString()
}

// ä¿®æ”¹å
const formatDate = (dateString: string) => {
  if (typeof window !== 'undefined') {
    return new Date(dateString).toLocaleString()
  }
  return new Date(dateString).toISOString()
}
            </div>
            <p>åªåœ¨å®¢æˆ·ç«¯ä½¿ç”¨toLocaleStringï¼ŒæœåŠ¡å™¨ç«¯ä½¿ç”¨ISOæ ¼å¼</p>
        </div>

        <div class="fix-item">
            <strong>3. ä¿®å¤navigator.clipboardä½¿ç”¨</strong><br>
            <div class="code-block">
// ä¿®æ”¹å‰
await navigator.clipboard.writeText(text)

// ä¿®æ”¹å
if (typeof navigator !== 'undefined' && navigator.clipboard) {
  await navigator.clipboard.writeText(text)
} else {
  // å›é€€æ–¹æ¡ˆï¼šä½¿ç”¨ä¼ ç»Ÿçš„å¤åˆ¶æ–¹æ³•
  const textArea = document.createElement('textarea')
  textArea.value = text
  document.body.appendChild(textArea)
  textArea.select()
  document.execCommand('copy')
  document.body.removeChild(textArea)
}
            </div>
            <p>åªåœ¨å®¢æˆ·ç«¯ä½¿ç”¨navigator.clipboardï¼Œæä¾›å›é€€æ–¹æ¡ˆ</p>
        </div>

        <div class="fix-item">
            <strong>4. ä¿®å¤Fileç»„ä»¶åç§°å†²çª</strong><br>
            <div class="code-block">
// ä¿®æ”¹å‰
import { File, ... } from "lucide-react"

// ä¿®æ”¹å
import { File as FileIcon, ... } from "lucide-react"
            </div>
            <p>é¿å…ä¸DOM Fileæ„é€ å‡½æ•°å†²çª</p>
        </div>
    </div>

    <div class="test-section">
        <h2>ä¿®å¤çš„æ–‡ä»¶</h2>
        <div class="code-block">
ä¿®å¤çš„æ–‡ä»¶åˆ—è¡¨:
- components/admin/r2-browser.tsx (URLSearchParams, toLocaleString)
- components/admin/database-management.tsx (toLocaleString)
- app/shares/page.tsx (toLocaleString, navigator.clipboard)
- components/files/file-list.tsx (navigator.clipboard, Fileç»„ä»¶å†²çª)
        </div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•æ­¥éª¤</h2>
        <div class="status info">
            <strong>éªŒè¯æ­¥éª¤:</strong><br>
            1. é‡å¯å‰ç«¯å¼€å‘æœåŠ¡å™¨<br>
            2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜<br>
            3. è®¿é—®æ–‡ä»¶ç®¡ç†é¡µé¢<br>
            4. åˆ‡æ¢åˆ°"R2æŒ‚è½½"æ ‡ç­¾é¡µ<br>
            5. ç‚¹å‡»"åˆ›å»ºæŒ‚è½½ç‚¹"æŒ‰é’®<br>
            6. åœ¨R2è·¯å¾„è¾“å…¥æ¡†æ—è¾¹ç‚¹å‡»"æµè§ˆ"æŒ‰é’®<br>
            7. åœ¨R2æµè§ˆå™¨ä¸­ç‚¹å‡»"ä½¿ç”¨å½“å‰è·¯å¾„"æŒ‰é’®ï¼ˆæ ¹ç›®å½•ï¼‰<br>
            8. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯<br>
            9. éªŒè¯æ ¹è·¯å¾„é€‰æ‹©æ˜¯å¦æ­£å¸¸å·¥ä½œ
        </div>
    </div>

    <div class="test-section">
        <h2>ä¿®å¤çŠ¶æ€</h2>
        <div class="status success">
            <strong>ä¿®å¤å®Œæˆ:</strong><br>
            âœ… 1. URLSearchParamsä½¿ç”¨å·²ä¿®å¤<br>
            âœ… 2. toLocaleStringä½¿ç”¨å·²ä¿®å¤<br>
            âœ… 3. navigator.clipboardä½¿ç”¨å·²ä¿®å¤<br>
            âœ… 4. Fileç»„ä»¶åç§°å†²çªå·²ä¿®å¤<br>
            âœ… 5. æ‰€æœ‰æµè§ˆå™¨APIè®¿é—®å·²æ·»åŠ ç¯å¢ƒæ£€æŸ¥<br>
            ğŸ”„ 6. ç­‰å¾…å®é™…æµ‹è¯•éªŒè¯...
        </div>
    </div>

    <div class="test-section">
        <h2>æŠ€æœ¯åŸç†</h2>
        <div class="code-block">
R2æ ¹è·¯å¾„é€‰æ‹©SSRé—®é¢˜:
- æ ¹è·¯å¾„é€‰æ‹©æ—¶è§¦å‘ç‰¹å®šçš„ç»„ä»¶æ¸²æŸ“é€»è¾‘
- æœåŠ¡å™¨ç«¯æ¸²æŸ“æ—¶è®¿é—®äº†æµè§ˆå™¨ç‰¹å®šçš„API
- URLSearchParamsåœ¨æœåŠ¡å™¨ç«¯ä¸å¯ç”¨
- toLocaleStringåœ¨æœåŠ¡å™¨ç«¯å¯èƒ½ä¸å¯ç”¨
- navigator.clipboardåœ¨æœåŠ¡å™¨ç«¯ä¸å¯ç”¨
- éœ€è¦ä¸ºæ‰€æœ‰æµè§ˆå™¨APIæä¾›ç¯å¢ƒæ£€æŸ¥å’Œå›é€€æ–¹æ¡ˆ
        </div>
    </div>

    <div class="test-section">
        <h2>é¢„æœŸæ•ˆæœ</h2>
        <div class="status success">
            <strong>ä¿®å¤åæ•ˆæœ:</strong><br>
            âœ… R2æ ¹è·¯å¾„é€‰æ‹©ä¸å†æŠ¥é”™<br>
            âœ… æ‰€æœ‰è·¯å¾„é€‰æ‹©åŠŸèƒ½æ­£å¸¸å·¥ä½œ<br>
            âœ… æœåŠ¡å™¨ç«¯æ¸²æŸ“ä¸ä¼šæŠ¥é”™<br>
            âœ… å®¢æˆ·ç«¯åŠŸèƒ½ä¿æŒä¸€è‡´<br>
            âœ… ç”¨æˆ·ä½“éªŒæ›´åŠ ç¨³å®š
        </div>
    </div>

    <script>
        console.log('ğŸ”§ R2æ ¹è·¯å¾„SSRä¿®å¤æµ‹è¯•é¡µé¢å·²åŠ è½½');
        console.log('ğŸ“ ä¿®å¤å†…å®¹:');
        console.log('1. URLSearchParamsä½¿ç”¨ä¿®å¤');
        console.log('2. toLocaleStringä½¿ç”¨ä¿®å¤');
        console.log('3. navigator.clipboardä½¿ç”¨ä¿®å¤');
        console.log('4. Fileç»„ä»¶åç§°å†²çªä¿®å¤');
        console.log('5. æ‰€æœ‰æµè§ˆå™¨APIç¯å¢ƒæ£€æŸ¥');
    </script>
</body>
</html> 