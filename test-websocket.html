<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
</head>
<body>
    <h1>WebSocket日志连接测试</h1>
    <button onclick="connect()">连接</button>
    <button onclick="disconnect()">断开</button>
    <div id="status">未连接</div>
    <div id="logs" style="border: 1px solid #ccc; height: 300px; overflow-y: auto; padding: 10px; margin-top: 10px;"></div>

    <script>
        let ws = null;
        
        function connect() {
            const status = document.getElementById('status');
            const logs = document.getElementById('logs');
            
            try {
                ws = new WebSocket('ws://localhost:8080/logs/stream');
                
                ws.onopen = function() {
                    status.textContent = '已连接';
                    status.style.color = 'green';
                    addLog('WebSocket连接已建立');
                };
                
                ws.onmessage = function(event) {
                    const data = JSON.parse(event.data);
                    addLog('收到消息: ' + JSON.stringify(data));
                };
                
                ws.onclose = function() {
                    status.textContent = '已断开';
                    status.style.color = 'red';
                    addLog('WebSocket连接已关闭');
                };
                
                ws.onerror = function(error) {
                    status.textContent = '连接错误';
                    status.style.color = 'red';
                    addLog('WebSocket错误: ' + error);
                };
                
            } catch (error) {
                addLog('连接失败: ' + error);
            }
        }
        
        function disconnect() {
            if (ws) {
                ws.close();
                ws = null;
            }
        }
        
        function addLog(message) {
            const logs = document.getElementById('logs');
            const time = new Date().toLocaleTimeString();
            logs.innerHTML += `<div>[${time}] ${message}</div>`;
            logs.scrollTop = logs.scrollHeight;
        }
    </script>
</body>
</html>
